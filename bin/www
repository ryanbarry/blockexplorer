#!/usr/bin/env coffee

# GENERATED BY EXPRESS-GENERATOR

###
 # Module dependencies.
###

#require('coffee-script/register');
app = require '../server/app'
debug = require('debug')('test:server')
http = require 'http'

###
 # Get port from environment and store in Express.
###

port = parseInt(process.env.PORT, 10) || 3000
app.set('port', port)

###
 * Create HTTP server.
###

server = http.createServer(app)

###
 * Event listener for HTTP server "error" event.
###

onError = (error) ->
  if error.syscall isnt 'listen'
    throw error

  # handle specific listen errors with friendly messages
  switch (error.code)
    when 'EACCES'
      console.error('Port ' + port + ' requires elevated privileges')
      process.exit(1)
      break
    when 'EADDRINUSE'
      console.error('Port ' + port + ' is already in use')
      process.exit(1)
      break
    else
      throw error

###
 * Event listener for HTTP server "listening" event.
###

onListening = () ->
  debug('Listening on port ' + server.address().port)

###
 * Listen on provided port, on all network interfaces.
###

server.listen(port)
server.on('error', onError)
server.on('listening', onListening)

